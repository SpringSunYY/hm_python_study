import sqlite3


# 初始化数据库
def create_db():
    # 连接到 SQLite 数据库
    conn = sqlite3.connect('library.db')
    cursor = conn.cursor()

    # 创建 books 表：用于存储图书信息
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS books (
            book_id TEXT PRIMARY KEY,        -- 书号，主键
            title TEXT,                      -- 书名
            publisher TEXT,                  -- 出版社
            author TEXT,                     -- 作者
            status TEXT,                     -- 图书状态（可借、已借）
            borrow_count INTEGER DEFAULT 0   -- 借阅次数，默认为 0
        )
    ''')

    # 创建 borrow_records 表：用于记录借阅操作
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS borrow_records (
            record_id INTEGER PRIMARY KEY AUTOINCREMENT,  -- 记录ID，自增
            book_id TEXT,                                  -- 书号，外键，关联 books 表
            student_id TEXT,                               -- 学号
            action TEXT,                                   -- 操作（借阅或归还）
            time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- 操作时间，默认当前时间
            FOREIGN KEY (book_id) REFERENCES books(book_id) -- 外键约束，关联 books 表
        )
    ''')

    # 插入 10 本示例图书数据
    books = [
        ('1', '活着', '青花', '余华', '可借', 5),
        ('2', '平凡的世界', '作家出版社', '路遥', '可借', 3),
        ('3', '白夜行', '东野圭吾', '东野圭吾', '已借', 8),
        ('4', '解忧杂货店', '村上春树', '村上春树', '可借', 10),
        ('5', '围城', '人民文学出版社', '钱钟书', '已借', 12),
        ('6', '三体', '重庆出版社', '刘慈欣', '可借', 15),
        ('7', '1984', '译林出版社', '乔治·奥威尔', '已借', 7),
        ('8', '西游记', '人民文学出版社', '吴承恩', '可借', 20),
        ('9', '鲁迅选集', '人民文学出版社', '鲁迅', '已借', 5),
        ('10', '撒哈拉的故事', '北京出版社', '三毛', '可借', 6)
    ]

    cursor.executemany('''
        INSERT INTO books (book_id, title, publisher, author, status, borrow_count)
        VALUES (?, ?, ?, ?, ?, ?)
    ''', books)

    # 插入 20 条借阅记录
    borrow_records = [
        ('1', '202301', '借阅', '2024-12-01 10:00:00'),
        ('2', '202302', '借阅', '2024-12-01 11:00:00'),
        ('3', '202303', '归还', '2024-12-02 12:00:00'),
        ('4', '202304', '借阅', '2024-12-03 14:00:00'),
        ('5', '202305', '借阅', '2024-12-04 15:00:00'),
        ('6', '202306', '归还', '2024-12-05 16:00:00'),
        ('7', '202307', '借阅', '2024-12-06 17:00:00'),
        ('8', '202308', '借阅', '2024-12-07 18:00:00'),
        ('9', '202309', '归还', '2024-12-08 19:00:00'),
        ('10', '202310', '借阅', '2024-12-09 20:00:00'),
        ('1', '202311', '归还', '2024-12-10 21:00:00'),
        ('2', '202312', '借阅', '2024-12-11 22:00:00'),
        ('3', '202313', '借阅', '2024-12-12 23:00:00'),
        ('4', '202314', '归还', '2024-12-13 09:00:00'),
        ('5', '202315', '借阅', '2024-12-14 10:00:00'),
        ('6', '202316', '归还', '2024-12-15 11:00:00'),
        ('7', '202317', '借阅', '2024-12-16 12:00:00'),
        ('8', '202318', '借阅', '2024-12-17 13:00:00'),
        ('9', '202319', '归还', '2024-12-18 14:00:00'),
        ('10', '202320', '借阅', '2024-12-19 15:00:00'),
        ('1', '202321', '归还', '2024-12-20 16:00:00')
    ]

    cursor.executemany('''
        INSERT INTO borrow_records (book_id, student_id, action, time)
        VALUES (?, ?, ?, ?)
    ''', borrow_records)

    # 提交事务并关闭连接
    conn.commit()
    conn.close()


# 调用创建数据库和表，并插入数据
create_db()
